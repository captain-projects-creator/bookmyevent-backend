<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Login â€” Event Booking</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .auth { max-width:420px;margin:40px auto;background:#fff;padding:20px;border-radius:12px;box-shadow:0 8px 22px rgba(2,6,23,0.06); animation: popIn .28s ease both; }
        .toggle { margin-top:8px; font-size:13px; color:#6b7280; cursor:pointer; text-decoration:underline; }
    </style>
</head>
<body>
<div class="auth">
    <h2>Login</h2>

    <div id="passwordLogin">
        <label>Username</label>
        <input id="username" placeholder="Username">

        <label>Password</label>
        <input id="password" type="password" placeholder="Password">

        <div style="margin-top:12px;">
            <button id="loginBtn" class="btn">Login</button>
            <a href="register.html" style="margin-left:10px">Register</a>
        </div>
    </div>

    <div id="otpLogin" style="display:none; margin-top:12px;">
        <label>Email or Mobile</label>
        <input id="dest" placeholder="you@example.com or +911234567890">

        <div style="display:flex;gap:8px;margin-top:8px;">
            <button id="sendOtp" class="btn ghost small">Send OTP</button>
            <button id="loginWithOtp" class="btn small">Login with OTP</button>
        </div>

        <label style="margin-top:8px">OTP</label>
        <input id="otp" placeholder="Enter OTP">
    </div>

    <div style="margin-top:8px;">
        <span id="toggleMode" class="toggle">Login with OTP instead</span>
    </div>

    <div id="msg" style="margin-top:10px;color:#b91c1c"></div>
</div>

<script>
    const API = '/api/auth';
    function el(i){return document.getElementById(i);}
    let otpMode = false;
    el('toggleMode').addEventListener('click', () => {
      otpMode = !otpMode;
      el('passwordLogin').style.display = otpMode ? 'none' : 'block';
      el('otpLogin').style.display = otpMode ? 'block' : 'none';
      el('toggleMode').innerText = otpMode ? 'Login with username/password instead' : 'Login with OTP instead';
      el('msg').innerText = '';
    });

    el('loginBtn').addEventListener('click', async () => {
      el('msg').innerText = '';
      const username = el('username').value.trim();
      const password = el('password').value;
      if (!username || !password) { el('msg').innerText = 'Enter username & password'; return; }
      try {
        const res = await fetch(API + '/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({username, password})});
        const body = await res.json();
        if (!res.ok) { el('msg').innerText = body.message || 'Login failed'; return; }
        localStorage.setItem('token', body.token);
        window.location.href = 'index.html';
      } catch (err) { el('msg').innerText = 'Login error: ' + err.message; }
    });

    el('sendOtp').addEventListener('click', async () => {
      el('msg').innerText = '';
      const to = el('dest').value.trim();
      if (!to) { el('msg').innerText = 'Enter email or mobile'; return; }
      try {
        const res = await fetch(API + '/send-otp', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({to})});
        const body = await res.json();
        if (!res.ok) { el('msg').innerText = body.message || 'Failed to send OTP'; return; }
        el('msg').style.color = '#059669';
        el('msg').innerText = 'OTP sent. Hint: ' + (body.masked || '');
        setTimeout(()=>{ el('msg').innerText=''; el('msg').style.color='#b91c1c'; }, 8000);
      } catch (err) { el('msg').innerText = 'Error: ' + err.message; }
    });

    el('loginWithOtp').addEventListener('click', async () => {
      el('msg').innerText = '';
      const to = el('dest').value.trim();
      const otp = el('otp').value.trim();
      if (!to || !otp) { el('msg').innerText = 'Enter destination and OTP'; return; }
      try {
        const res = await fetch(API + '/login-otp', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({to, otp})});
        const body = await res.json();
        if (!res.ok) { el('msg').innerText = body.message || 'OTP login failed'; return; }
        localStorage.setItem('token', body.token);
        window.location.href = 'index.html';
      } catch (err) { el('msg').innerText = 'Login error: ' + err.message; }
    });
</script>
</body>
</html>